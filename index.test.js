const process = require("process");
const cp = require("child_process");
const path = require("path");

test("test runs", () => {
  const lcovPath = "./fixtures/lcov.info";
  process.env["INPUT_PATH"] = lcovPath;
  const ip = path.join(__dirname, "index.js");
  const actual = cp.execSync(`node ${ip}`, { env: process.env }).toString();
  const expected = `::debug::${lcovPath}\n::debug::[{"lines":{"found":40,"hit":40,"details":[{"line":21,"hit":2},{"line":22,"hit":1},{"line":26,"hit":3},{"line":37,"hit":1},{"line":39,"hit":2},{"line":41,"hit":1},{"line":42,"hit":2},{"line":44,"hit":1},{"line":66,"hit":1},{"line":70,"hit":2},{"line":105,"hit":1},{"line":109,"hit":1},{"line":135,"hit":1},{"line":162,"hit":1},{"line":166,"hit":2},{"line":170,"hit":1},{"line":172,"hit":1},{"line":197,"hit":1},{"line":201,"hit":1},{"line":212,"hit":1},{"line":213,"hit":3},{"line":214,"hit":3},{"line":215,"hit":1},{"line":223,"hit":1},{"line":225,"hit":1},{"line":227,"hit":1},{"line":228,"hit":2},{"line":229,"hit":1},{"line":230,"hit":2},{"line":231,"hit":3},{"line":232,"hit":2},{"line":233,"hit":1},{"line":239,"hit":1},{"line":240,"hit":1},{"line":241,"hit":4},{"line":243,"hit":1},{"line":244,"hit":2},{"line":246,"hit":1},{"line":248,"hit":1},{"line":250,"hit":1}]},"functions":{"hit":0,"found":0,"details":[]},"branches":{"hit":0,"found":0,"details":[]},"file":"/Users/felix/Development/github.com/felangel/bloc/packages/bloc/lib/src/bloc.dart"},{"lines":{"found":6,"hit":6,"details":[{"line":14,"hit":1},{"line":20,"hit":1},{"line":27,"hit":1},{"line":36,"hit":1},{"line":43,"hit":1},{"line":51,"hit":1}]},"functions":{"hit":0,"found":0,"details":[]},"branches":{"hit":0,"found":0,"details":[]},"file":"/Users/felix/Development/github.com/felangel/bloc/packages/bloc/lib/src/bloc_observer.dart"},{"lines":{"found":10,"hit":10,"details":[{"line":10,"hit":1},{"line":18,"hit":1},{"line":21,"hit":1},{"line":22,"hit":3},{"line":23,"hit":3},{"line":24,"hit":3},{"line":26,"hit":1},{"line":27,"hit":5},{"line":29,"hit":1},{"line":31,"hit":3}]},"functions":{"hit":0,"found":0,"details":[]},"branches":{"hit":0,"found":0,"details":[]},"file":"/Users/felix/Development/github.com/felangel/bloc/packages/bloc/lib/src/change.dart"},{"lines":{"found":32,"hit":32,"details":[{"line":16,"hit":1},{"line":27,"hit":1},{"line":29,"hit":3},{"line":30,"hit":1},{"line":54,"hit":1},{"line":56,"hit":2},{"line":60,"hit":2},{"line":62,"hit":2},{"line":79,"hit":1},{"line":82,"hit":2},{"line":83,"hit":2},{"line":84,"hit":3},{"line":85,"hit":3},{"line":86,"hit":1},{"line":87,"hit":3},{"line":88,"hit":1},{"line":92,"hit":1},{"line":93,"hit":1},{"line":115,"hit":1},{"line":118,"hit":2},{"line":138,"hit":1},{"line":142,"hit":2},{"line":143,"hit":1},{"line":144,"hit":1},{"line":145,"hit":1},{"line":152,"hit":1},{"line":159,"hit":2},{"line":160,"hit":3},{"line":170,"hit":1},{"line":175,"hit":1},{"line":178,"hit":2},{"line":179,"hit":2}]},"functions":{"hit":0,"found":0,"details":[]},"branches":{"hit":0,"found":0,"details":[]},"file":"/Users/felix/Development/github.com/felangel/bloc/packages/bloc/lib/src/cubit.dart"},{"lines":{"found":12,"hit":12,"details":[{"line":14,"hit":1},{"line":18,"hit":1},{"line":23,"hit":1},{"line":26,"hit":1},{"line":27,"hit":3},{"line":28,"hit":3},{"line":29,"hit":3},{"line":30,"hit":3},{"line":32,"hit":1},{"line":34,"hit":8},{"line":37,"hit":1},{"line":39,"hit":4}]},"functions":{"hit":0,"found":0,"details":[]},"branches":{"hit":0,"found":0,"details":[]},"file":"/Users/felix/Development/github.com/felangel/bloc/packages/bloc/lib/src/transition.dart"}]\n`;
  expect(actual).toEqual(expected);
});
